# PostgreSQL Cluster с Репликацией и Шардированием

Этот проект настраивает кластер PostgreSQL с репликацией и шардированием данных. Используется Docker Compose для развертывания нескольких сервисов PostgreSQL, где каждый сервис отвечает за репликацию и хранение данных для различных регионов.

## Для запуска кластера:
`
make up
`
## Отключить:
`
make down
`

#### По умолчанию используются тестовые данные, если они не нужны, то следует закоментировать или удалить строку 26 в docker-compose.yml
`
      - ./testdata.sql:/docker-entrypoint-initdb.d/testdata.sql
`

### Для проверки данных используется образ admirer по адресу localhost:8080
| Имя хоста       | Репликация         |
|-----------------|--------------------|
| main            | main_pg_replica    |
| RU_shard        | RU_pg_replica      |
| EU_shard        | EU_pg_replica      |
| WW_shard        | WW_pg_replica      |


## Описание Кластера

В кластере настроены следующие компоненты:

- **Основной контейнер PostgreSQL** (`main_pg`), который хранит данные со всех регионов в таблице `all_users`
- **Репликации для основного контейнера и каждого шарда**.
- **Шардирование** данных по регионам: Россия (`RU_shard`), Европа (`EU_shard`), и остальные страны (`WW_shard`).
- **Adminer** — веб-интерфейс для управления базой данных.

## Структура базы данных

1. **Основные таблицы**:
    - `dlya_FSB`: Таблица для данных, относящихся к России (RU).
    - `GDPR`: Таблица для данных, относящихся к Европе (EU).
    - `WORLD`: Таблица для данных, относящихся к другим регионам (WW).

2. **Таблица `all_users`** используется для хранения всех пользователей с разделением по регионам.
   - Данные из каждой таблицы (`dlya_FSB`, `GDPR`, `WORLD`) распределяются по соответствующим разделам.

3. **Репликация**:
    - Настроены репликационные слоты для каждого региона и основного контейнера.
    - Используется расширение `postgres_fdw` для подключения к удалённым серверам (шардам).

4. **Шарды**:
    - **RU_shard**: Сервис для данных региона России.
    - **EU_shard**: Сервис для данных региона Европы.
    - **WW_shard**: Сервис для данных для других стран.
